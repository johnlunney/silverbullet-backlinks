var mod=(()=>{var p=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var Z=Object.prototype.hasOwnProperty;var l=(e,t)=>{for(var n in t)p(e,n,{get:t[n],enumerable:!0})},W=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of G(t))!Z.call(e,i)&&i!==n&&p(e,i,{get:()=>t[i],enumerable:!(o=M(t,i))||o.enumerable});return e};var O=e=>W(p({},"__esModule",{value:!0}),e);var je={};l(je,{functionMapping:()=>B});function x(e){let t=atob(e),n=t.length,o=new Uint8Array(n);for(let i=0;i<n;i++)o[i]=t.charCodeAt(i);return o}function F(e,t){return syscall("sandboxFetch.fetch",e,t)}function P(){globalThis.nativeFetch=globalThis.fetch,globalThis.fetch=async function(e,t){let n=await F(e,t&&{method:t.method,headers:t.headers,body:t.body});return new Response(n.base64Body?x(n.base64Body):null,{status:n.status,headers:n.headers})}}typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var y=new Map,f=0;function u(e){self.postMessage(e)}self.syscall=async(e,...t)=>await new Promise((n,o)=>{f++,y.set(f,{resolve:n,reject:o}),u({type:"sys",id:f,name:e,args:t})});function h(e,t){self.addEventListener("message",n=>{(async()=>{let o=n.data;switch(o.type){case"inv":{let i=e[o.name];if(!i)throw new Error(`Function not loaded: ${o.name}`);try{let s=await Promise.resolve(i(...o.args||[]));u({type:"invr",id:o.id,result:s})}catch(s){console.error(s),u({type:"invr",id:o.id,error:s.message})}}break;case"sysr":{let i=o.id,s=y.get(i);if(!s)throw Error("Invalid request id");y.delete(i),o.error?s.reject(new Error(o.error)):s.resolve(o.result)}break}})().catch(console.error)}),u({type:"manifest",manifest:t})}P();var m={};l(m,{readAsset:()=>R});function D(e){let t=atob(e),n=t.length,o=new Uint8Array(n);for(let i=0;i<n;i++)o[i]=t.charCodeAt(i);return o}function b(e){let t=e.split(",",2)[1];return D(t)}var c=self.syscall;async function R(e,t="utf8"){let n=await c("asset.readAsset",e);switch(t){case"utf8":return new TextDecoder().decode(b(n));case"dataurl":return n}}var a={};l(a,{confirm:()=>ae,dispatch:()=>ie,downloadFile:()=>Q,filterBox:()=>X,flashNotification:()=>J,fold:()=>me,foldAll:()=>fe,getCurrentPage:()=>U,getCursor:()=>Y,getSelection:()=>z,getText:()=>E,getUiOption:()=>ce,hidePanel:()=>ee,insertAtCursor:()=>oe,insertAtPos:()=>te,moveCursor:()=>ne,navigate:()=>V,openUrl:()=>q,prompt:()=>se,reloadPage:()=>$,replaceRange:()=>re,save:()=>N,setPage:()=>T,setSelection:()=>H,setUiOption:()=>le,showPanel:()=>_,syncSpace:()=>ue,toggleFold:()=>pe,unfold:()=>de,unfoldAll:()=>ye,vimEx:()=>ge});typeof self>"u"&&(self={syscall:()=>{throw new Error("Not implemented here")}});var r=self.syscall;function U(){return r("editor.getCurrentPage")}function T(e){return r("editor.setPage",e)}function E(){return r("editor.getText")}function Y(){return r("editor.getCursor")}function z(){return r("editor.getSelection")}function H(e,t){return r("editor.setSelection",e,t)}function N(){return r("editor.save")}function V(e,t,n=!1,o=!1){return r("editor.navigate",e,t,n,o)}function $(){return r("editor.reloadPage")}function q(e,t=!1){return r("editor.openUrl",e,t)}function Q(e,t){return r("editor.downloadFile",e,t)}function J(e,t="info"){return r("editor.flashNotification",e,t)}function X(e,t,n="",o=""){return r("editor.filterBox",e,t,n,o)}function _(e,t,n,o=""){return r("editor.showPanel",e,t,n,o)}function ee(e){return r("editor.hidePanel",e)}function te(e,t){return r("editor.insertAtPos",e,t)}function re(e,t,n){return r("editor.replaceRange",e,t,n)}function ne(e,t=!1){return r("editor.moveCursor",e,t)}function oe(e){return r("editor.insertAtCursor",e)}function ie(e){return r("editor.dispatch",e)}function se(e,t=""){return r("editor.prompt",e,t)}function ae(e){return r("editor.confirm",e)}function ce(e){return r("editor.getUiOption",e)}function le(e,t){return r("editor.setUiOption",e,t)}function ge(e){return r("editor.vimEx",e)}function ue(){return r("editor.syncSpace")}function me(){return r("editor.fold")}function de(){return r("editor.unfold")}function pe(){return r("editor.toggleFold")}function fe(){return r("editor.foldAll")}function ye(){return r("editor.unfoldAll")}var d={};l(d,{batchSet:()=>Pe,clearPageIndex:()=>Ce,clearPageIndexForPage:()=>we,del:()=>be,deletePrefixForPage:()=>Ae,get:()=>he,query:()=>ve,queryPrefix:()=>ke,set:()=>xe});function xe(e,t,n){return r("index.set",e,t,n)}function Pe(e,t){return r("index.batchSet",e,t)}function he(e,t){return r("index.get",e,t)}function be(e,t){return r("index.delete",e,t)}function ke(e){return r("index.queryPrefix",e)}function ve(e){return r("index.query",e)}function we(e){return r("index.clearPageIndexForPage",e)}function Ae(e,t){return r("index.deletePrefixForPage",e,t)}function Ce(){return r("index.clearPageIndex")}var g={};l(g,{del:()=>We,get:()=>Ze,set:()=>Ge});function Ge(e,t){return r("store.set",e,t)}function Ze(e){return r("store.get",e)}function We(e){return r("store.delete",e)}var k="showBacklinks";async function v(){let e=await I();if(await g.set(k,!e),e)await a.hidePanel("lhs");else{let t=await a.getCurrentPage();await C(t)}}async function w(){let e=await a.getCurrentPage();await C(e)}async function A(e){if(e.length===0){console.log("no page name supplied, ignoring navigation");return}let[t,n]=e.split("@");console.log(`navigating to ${e}`),await a.navigate(t,+n)}var De=`
  function processClick(e) {
    let pageName = e.currentTarget.getAttribute('data-page');
    if (!pageName) {
      console.log('no page value for:');
      console.log(e);
      pageName = '';
    }
    removeListeners();
    // send an event so the navigation happens internally preventing a full page reload
    sendEvent('backlink:navigateTo', pageName);
  }

  function getLinks() {
    return Array.from(document.getElementsByTagName('li'));
  }
  // remove listeners once we are done
  function removeListeners() {
    const links = getLinks();
    links.forEach((item) => item.removeEventListener('click', processClick));
  }

  // make li tags clickable
  const linkList = getLinks();
  linkList.forEach((item) => item.addEventListener('click', processClick));
`;async function C(e){if(await I()){let t=await Re(e),n=await m.readAsset("style.css"),o=t.length===0?"No links found":Ke(t);await a.showPanel("lhs",.5,`<html><head><style>${n}</style></head><body>
        <h2>Backlinks</h2>
        <ul>
        ${o}
        </ul>
        </body></html>`,De)}}async function I(){return!!await g.get(k)}async function Re(e){return(await d.queryPrefix(`l:${e}:`)).map(({page:o,key:i})=>{let[,,s]=i.split(":");return`${o}@${s}`})}function Ke(e){return e.map(n=>`<li data-page="${n}">\u{1F587}\uFE0F&nbsp;<span class="wiki-link">[[</span><span class="wiki-link-page">${n}</span><span class="wiki-link">]]</span></li>`).join("")}var B={toggle:v,updateBacklinks:w,navigateTo:A},Se={name:"backlinks",version:.4,assets:{"style.css":{data:"data:text/css;base64,Ym9keSB7CiAgZm9udC1mYW1pbHk6IGdlb3JnaWEsdGltZXMsc2VyaWY7CiAgZm9udC1zaXplOiAxNHB0OwogIHdpZHRoOiAxMDAlOwogIG1hcmdpbi1sZWZ0OiBhdXRvOwogIG1hcmdpbi1yaWdodDogYXV0bzsKICBwYWRkaW5nLWxlZnQ6IDIwcHg7CiAgcGFkZGluZy1yaWdodDogMjBweDsKfQoKdGFibGUgewogIHdpZHRoOiAxMDAlOwogIGJvcmRlci1zcGFjaW5nOiAwOwp9Cgp1bCB7CiAgbWFyZ2luLWxlZnQ6IDA7CiAgcGFkZGluZy1sZWZ0OiAwOwp9CgpsaSB7CiAgbGlzdC1zdHlsZTogbm9uZTsKfQoKdGhlYWQgdHIgewogICAgYmFja2dyb3VuZC1jb2xvcjogIzMzMzsKICAgIGNvbG9yOiAjZWVlOwp9Cgp0aCwgdGQgewogICAgcGFkZGluZzogOHB4Owp9Cgp0Ym9keSB0cjpudGgtb2YtdHlwZShldmVuKSB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjNmM2YzOwp9CgphW2hyZWZdIHsKICB0ZXh0LWRlY29yYXRpb246IG5vbmU7Cn0KCmJsb2NrcXVvdGUgewogIGJvcmRlci1sZWZ0OiAxcHggc29saWQgIzMzMzsKICBtYXJnaW4tbGVmdDogMnB4OwogIHBhZGRpbmctbGVmdDogMTBweDsKfQoKaHIgewogICAgbWFyZ2luOiAxZW0gMCAxZW0gMDsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIGJvcmRlci1jb2xvcjogIzc3NzsKICAgIGJvcmRlci13aWR0aDogMDsKICAgIGJvcmRlci1zdHlsZTogZG90dGVkOwp9CgpocjphZnRlciB7CiAgICBjb250ZW50OiAiwrfCt8K3IjsKICAgIGxldHRlci1zcGFjaW5nOiAxZW07Cn0KCnNwYW4ud2lraS1saW5rIHsKCiAgY3Vyc29yOiBwb2ludGVyOwogIGNvbG9yOiAjYThhYmJkOwp9CgpzcGFuLndpa2ktbGluay1wYWdlIHsKICBjb2xvcjogIzAzMzBjYjsKICBjdXJzb3I6IHBvaW50ZXI7CiAgYmFja2dyb3VuZC1jb2xvcjogIzRkOGRmZjEyOwogIGJvcmRlci1yYWRpdXM6IDVweDsKICBwYWRkaW5nOiAwIDVweDsKfQ==",mtime:1690355567611}},functions:{toggle:{path:"./backlinks.ts:toggleBacklinks",command:{name:"Show Backlinks for current page",key:"ctrl-shift-b",mac:"Cmd-shift-b"}},updateBacklinks:{path:"./backlinks.ts:updateBacklinks",env:"client",events:["plug:load","editor:pageLoaded"]},navigateTo:{path:"./backlinks.ts:navigateTo",events:["backlink:navigateTo"]}}};h(B,Se);return O(je);})();
